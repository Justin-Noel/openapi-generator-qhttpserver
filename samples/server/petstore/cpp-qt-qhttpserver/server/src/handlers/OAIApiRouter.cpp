/**
 * OpenAPI Petstore
 * This is a sample server Petstore server. For this sample, you can use the api key `special-key` to test the authorization filters.
 *
 * The version of the OpenAPI document: 1.0.0
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */

#include <QJsonArray>
#include <QJsonDocument>
#include <QJsonObject>
#include <QVariantMap>
#include <QHttpServerRequest>
#include <QHttpServerResponse>
#include <QUrlQuery>

#include "OAIApiRouter.h"
#include "OAIHelpers.h"

namespace OpenAPI {

OAIApiRouter::OAIApiRouter(QHttpServer *server) : m_server(server) {
    createApiHandlers();
}

OAIApiRouter::~OAIApiRouter(){

}

void OAIApiRouter::createApiHandlers() { 
    mOAIPetApiHandler = QSharedPointer<OAIPetApiHandler>::create();
    mOAIStoreApiHandler = QSharedPointer<OAIStoreApiHandler>::create();
    mOAIUserApiHandler = QSharedPointer<OAIUserApiHandler>::create();
}


void OAIApiRouter::setOAIPetApiHandler(QSharedPointer<OAIPetApiHandler> handler){
    mOAIPetApiHandler = handler;
}
void OAIApiRouter::setOAIStoreApiHandler(QSharedPointer<OAIStoreApiHandler> handler){
    mOAIStoreApiHandler = handler;
}
void OAIApiRouter::setOAIUserApiHandler(QSharedPointer<OAIUserApiHandler> handler){
    mOAIUserApiHandler = handler;
}

void OAIApiRouter::setupRoutes() {
    
    // POST /pet
    m_server->route("/v2/pet",
        QHttpServerRequest::Method::POST,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            OAIPet body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            ::OpenAPI::fromJsonValue(body, doc.object());


            // Call handler
            mOAIPetApiHandler->addPet(body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // DELETE /pet/{petId}
    m_server->route("/v2/pet/{petId}",
        QHttpServerRequest::Method::DELETE,
        [this](qint64 pet_id, const QHttpServerRequest &request) {
            // Header parameters
            QString api_key;
            if (request.headers().contains("api_key")) {
                ::OpenAPI::fromStringValue(
                    QString::fromUtf8(request.headers().value("api_key")), api_key);
            }

            // Call handler
            mOAIPetApiHandler->deletePet(pet_id, api_key);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // GET /pet/findByStatus
    m_server->route("/v2/pet/findByStatus",
        QHttpServerRequest::Method::GET,
        [this](const QHttpServerRequest &request) {
            // Query parameters
            auto query = request.query();
            QList<QString> status = QList<QString>();
            if (query.hasQueryItem("status")) {
                ::OpenAPI::fromStringValue(query.queryItemValue("status"), status);
            }

            // Call handler
            auto result = mOAIPetApiHandler->findPetsByStatus(status);

            // Serialize response
            QJsonArray jsonArray;
            for (const auto &item : result) {
                jsonArray.append(::OpenAPI::toJsonValue(item));
            }
            QJsonDocument doc(jsonArray);
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // GET /pet/findByTags
    m_server->route("/v2/pet/findByTags",
        QHttpServerRequest::Method::GET,
        [this](const QHttpServerRequest &request) {
            // Query parameters
            auto query = request.query();
            QList<QString> tags = QList<QString>();
            if (query.hasQueryItem("tags")) {
                ::OpenAPI::fromStringValue(query.queryItemValue("tags"), tags);
            }

            // Call handler
            auto result = mOAIPetApiHandler->findPetsByTags(tags);

            // Serialize response
            QJsonArray jsonArray;
            for (const auto &item : result) {
                jsonArray.append(::OpenAPI::toJsonValue(item));
            }
            QJsonDocument doc(jsonArray);
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // GET /pet/{petId}
    m_server->route("/v2/pet/{petId}",
        QHttpServerRequest::Method::GET,
        [this](qint64 pet_id, const QHttpServerRequest &request) {

            // Call handler
            auto result = mOAIPetApiHandler->getPetById(pet_id);

            // Serialize response
            QJsonDocument doc(::OpenAPI::toJsonValue(result).toObject());
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // PUT /pet
    m_server->route("/v2/pet",
        QHttpServerRequest::Method::PUT,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            OAIPet body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            ::OpenAPI::fromJsonValue(body, doc.object());


            // Call handler
            mOAIPetApiHandler->updatePet(body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // POST /pet/{petId}
    m_server->route("/v2/pet/{petId}",
        QHttpServerRequest::Method::POST,
        [this](qint64 pet_id, const QHttpServerRequest &request) {

            // Call handler
            mOAIPetApiHandler->updatePetWithForm(pet_id, name, status);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // POST /pet/{petId}/uploadImage
    m_server->route("/v2/pet/{petId}/uploadImage",
        QHttpServerRequest::Method::POST,
        [this](qint64 pet_id, const QHttpServerRequest &request) {

            // Call handler
            auto result = mOAIPetApiHandler->uploadFile(pet_id, additional_metadata, file);

            // Serialize response
            QJsonDocument doc(::OpenAPI::toJsonValue(result).toObject());
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // DELETE /store/order/{orderId}
    m_server->route("/v2/store/order/{orderId}",
        QHttpServerRequest::Method::DELETE,
        [this](const QString& order_id, const QHttpServerRequest &request) {

            // Call handler
            mOAIStoreApiHandler->deleteOrder(order_id);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // GET /store/inventory
    m_server->route("/v2/store/inventory",
        QHttpServerRequest::Method::GET,
        [this](const QHttpServerRequest &request) {

            // Call handler
            auto result = mOAIStoreApiHandler->getInventory();

            // Serialize response
            QByteArray body = ::OpenAPI::toStringValue(result).toUtf8();
            return QHttpServerResponse("text/plain", body);
        });
    
    // GET /store/order/{orderId}
    m_server->route("/v2/store/order/{orderId}",
        QHttpServerRequest::Method::GET,
        [this](qint64 order_id, const QHttpServerRequest &request) {

            // Call handler
            auto result = mOAIStoreApiHandler->getOrderById(order_id);

            // Serialize response
            QJsonDocument doc(::OpenAPI::toJsonValue(result).toObject());
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // POST /store/order
    m_server->route("/v2/store/order",
        QHttpServerRequest::Method::POST,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            OAIOrder body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            ::OpenAPI::fromJsonValue(body, doc.object());


            // Call handler
            auto result = mOAIStoreApiHandler->placeOrder(body);

            // Serialize response
            QJsonDocument doc(::OpenAPI::toJsonValue(result).toObject());
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // POST /user
    m_server->route("/v2/user",
        QHttpServerRequest::Method::POST,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            OAIUser body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            ::OpenAPI::fromJsonValue(body, doc.object());


            // Call handler
            mOAIUserApiHandler->createUser(body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // POST /user/createWithArray
    m_server->route("/v2/user/createWithArray",
        QHttpServerRequest::Method::POST,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            QList<OAIUser> body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            QJsonArray jsonArray = doc.array();
            for (const auto &item : jsonArray) {
                OAIUser obj;
                ::OpenAPI::fromJsonValue(obj, item);
                body.append(obj);
            }


            // Call handler
            mOAIUserApiHandler->createUsersWithArrayInput(body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // POST /user/createWithList
    m_server->route("/v2/user/createWithList",
        QHttpServerRequest::Method::POST,
        [this](const QHttpServerRequest &request) {
            // Body parameters

            QList<OAIUser> body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            QJsonArray jsonArray = doc.array();
            for (const auto &item : jsonArray) {
                OAIUser obj;
                ::OpenAPI::fromJsonValue(obj, item);
                body.append(obj);
            }


            // Call handler
            mOAIUserApiHandler->createUsersWithListInput(body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // DELETE /user/{username}
    m_server->route("/v2/user/{username}",
        QHttpServerRequest::Method::DELETE,
        [this](const QString& username, const QHttpServerRequest &request) {

            // Call handler
            mOAIUserApiHandler->deleteUser(username);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // GET /user/{username}
    m_server->route("/v2/user/{username}",
        QHttpServerRequest::Method::GET,
        [this](const QString& username, const QHttpServerRequest &request) {

            // Call handler
            auto result = mOAIUserApiHandler->getUserByName(username);

            // Serialize response
            QJsonDocument doc(::OpenAPI::toJsonValue(result).toObject());
            return QHttpServerResponse("application/json", doc.toJson(QJsonDocument::Compact));
        });
    
    // GET /user/login
    m_server->route("/v2/user/login",
        QHttpServerRequest::Method::GET,
        [this](const QHttpServerRequest &request) {
            // Query parameters
            auto query = request.query();
            QString username = QString("");
            if (query.hasQueryItem("username")) {
                ::OpenAPI::fromStringValue(query.queryItemValue("username"), username);
            }
            QString password = QString("");
            if (query.hasQueryItem("password")) {
                ::OpenAPI::fromStringValue(query.queryItemValue("password"), password);
            }

            // Call handler
            auto result = mOAIUserApiHandler->loginUser(username, password);

            // Serialize response
            QByteArray body = ::OpenAPI::toStringValue(result).toUtf8();
            return QHttpServerResponse("text/plain", body);
        });
    
    // GET /user/logout
    m_server->route("/v2/user/logout",
        QHttpServerRequest::Method::GET,
        [this](const QHttpServerRequest &request) {

            // Call handler
            mOAIUserApiHandler->logoutUser();
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
    // PUT /user/{username}
    m_server->route("/v2/user/{username}",
        QHttpServerRequest::Method::PUT,
        [this](const QString& username, const QHttpServerRequest &request) {
            // Body parameters

            OAIUser body;
            QJsonDocument doc = QJsonDocument::fromJson(request.body());
            ::OpenAPI::fromJsonValue(body, doc.object());


            // Call handler
            mOAIUserApiHandler->updateUser(username, body);
            return QHttpServerResponse(QHttpServerResponse::StatusCode::Ok);
        });
    
}

}
